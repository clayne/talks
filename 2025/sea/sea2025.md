---
marp: true
theme: base
title: Algorithms for Modern Processor Architectures
description: Daniel Lemire is a computer science professor at the Data Science Laboratory of the University of Quebec (TELUQ). He is ranked in the top 2% of all scientists (Stanford University/Elsevier ranking, 2024). He is among the 1000 most followed programmers in the world on GitHub; GitHub has over 100 million developers. He published over 85 peer-reviewed research papers. His work is found in many standard libraries (.NET, Rust, GCC/glibc++, LLVM/libc, Go, Node.js, etc.) and in the major Web browsers (Safari, Chrome, etc.). He is an editor at the journal Software: Practice and Experience (Wiley, established in 1971). In 2020, he received the University of Quebec’s 2020 Award of Excellence for Achievement in Research for his work on the acceleration of JSON parsing. His research interests include high-performance programming.
paginate: true
_paginate: false
---



<!-- ![center](simdjsonlogo.png)-->

<!--  --- -->

## <!--fit--> Algorithms for Modern Processor Architectures


Daniel Lemire, professor
Université du Québec (TÉLUQ)
Montréal :canada:

blog: https://lemire.me 
X: [@lemire](https://x.com/lemire)
GitHub: [https://github.com/lemire/](https://github.com/lemire/)

All software for this talk: https://github.com/lemire/talks/tree/master/2025/sea/software
---


# Background

* Bitmap indexes (Google Procella, Lucene, Git, etc.)
* *Fastest JSON parser in the world*
* Number parsing at high speed (GCC, C#/.NET, Rust, Go, main web browsers such as Safari and Chrome)
* Fast unicode functions (main web browsers)
* Random number generation (Linux kernel, FreeBSD libc library, Go, Julia, C# runtime, Numpy, Swift standard library)
* URL parsing (Node.js)
* DNS (zone files)

---


# Disk at gigabytes per second

![](fastdisk.png)



---


# Input/Output

- PCI Express 4.0 (2011) : 31.5 GB/s (16 lanes)
- PCI Express 5.0 (2017) : 63 GB/s (16 lanes)
- PCI Express 6.0 (2019) : 128 GB/s (16 lanes)
- PCI Express 7.0 (2022) : 242 GB/s (16 lanes)



---

# Memory


`(Data Rate × Bus Width × Number of Channels) / 8`

- Bus Width: 64 bits
- Data Rate: *megatransfers per second* (or MHz)
- DDR5 6000 MHz, two channels would be 96 GB/s
- DDR6 might **double** the bandwidth

---

# High Bandwidth Memory

- Xeon Max processors contain 64 GB of HBM
- Bandwidth 800 GB/s





---

# Time is discrete

- Clock cycle

---


# Some numbers

- Processors: 4 GHz ($4 \times 10^9$ cycles per second)
- One cycle is 0.25 nanoseconds
- light: 7.5 centimeters
- One byte per cycle: 4 GB/s

---

# Frequencies and transistors

| processor | year  | frequency  | transistors    |
|-----------|-------|------------|----------------|
| Pentium 4 | 2000  | 3.8 GHz    | 0.040 billions | 
| Intel Haswell  | 2013  | 4.4 GHz    | 1.4 billions  | 
| Apple M1  | 2020  | 3.2 GHz    | 16 billions    | 
| Apple M2  | 2022  | 3.49 GHz   | 20 billions    |
| Apple M3  | 2024  | 4.05 GHz   | 25 billions    | 
| Apple M4  | 2024  | 4.5 GHz    | 28 billions    |
| AMD Zen 5 | 2024  | 5.7 GHz    | 50 billions    |


---

# Where do the transistors go?

- More cores
- More superscalar execution
- Better speculative execution
- More cache, more memory-level parallelism
- Better data-level parallelism (SIMD)


---

# Superscalar execution

| processor       | year    | arithmetic logic units    |
|-----------------|---------|---------------------------|
| Pentium 4       |  2000   |    2                      |
| AMD Zen 2       |  2019   |    4                      |
| AMD Zen 5       |  2024   |    6                      |

---

# Parsing a number

- about 200 instructions
- 7.5 instructions/cycle
- 25 cyccles

```cpp
double result;
fast_float::from_chars(
  input.data(), input.data() + input.size(), result);
```


---

# Deltas (C)

successive difference:

```cpp
    for (size_t i = 1; i < n; ++i) {
        dst[i] = src[i] - src[i - 1];
    }
```


prefix sum:

```cpp
    for (size_t i = 1; i < n; ++i) {
        dst[i] = dst[i - 1] + src[i];
    }
```


---

# Deltas (ARM ASM)

successive difference (6 instructions):
```asm
.START:
        ldp     w12, w11, [x9, #-4]
        subs    x8, x8, #1
        add     x9, x9, #4
        sub     w11, w11, w12
        str     w11, [x10], #4
        b.ne    .START
```


prefix sum (5 instructions):

```asm
.START:
        ldr     w12, [x11], #4
        subs    x10, x10, #1
        add     w9, w12, w9
        str     w9, [x8], #4
        b.ne    .START
```

---

Apple M4
| algorithm             | cycles   | instructions   | ins/cycle  |
|-----------------------|----------|----------------|------------|
| successive difference | 1 cycle  | 6 instructions | 6 instructions/cycle |
| prefix sum | 1 cycle  | 5 instructions | 5 instructions/cycle |

---

# Speculative execution


---

# Speculative execution


---

# Memory-level parallism


---

# Data-level parallelism 

---

# Measurements


---

# Conclusion